# üöÄ Guia de Configura√ß√£o - Appwrite Database

## üìã Vis√£o Geral

Este projeto utiliza o **Appwrite** como backend para gerenciar o banco de dados de perfil de usu√°rios, prefer√™ncias e configura√ß√µes. O Appwrite fornece uma API completa, autentica√ß√£o integrada e um painel de administra√ß√£o.

## üéØ Por que Appwrite?

- ‚úÖ **Backend-as-a-Service** completo
- ‚úÖ **Autentica√ß√£o** integrada
- ‚úÖ **Database** NoSQL flex√≠vel com rela√ß√µes
- ‚úÖ **Storage** para arquivos (avatars, documentos)
- ‚úÖ **Real-time** subscriptions
- ‚úÖ **Cloud Functions** para l√≥gica customizada
- ‚úÖ **Console Web** para administra√ß√£o
- ‚úÖ **SDK TypeScript** type-safe

## üõ†Ô∏è Passo 1: Criar Conta no Appwrite

### Op√ß√£o A: Appwrite Cloud (Recomendado)

1. Acesse: https://cloud.appwrite.io
2. Crie uma conta gratuita
3. Crie um novo projeto chamado "Horizon AI"
4. Anote o **Project ID**

### Op√ß√£o B: Self-Hosted

```bash
docker run -d \
  --name appwrite \
  -p 80:80 \
  -p 443:443 \
  -v appwrite_data:/storage \
  appwrite/appwrite:latest
```

## üîë Passo 2: Obter Credenciais

### 2.1. Project ID

No Appwrite Console:

1. V√° para **Settings** > **General**
2. Copie o **Project ID**

### 2.2. API Key

No Appwrite Console:

1. V√° para **Settings** > **API Keys**
2. Clique em **Add API Key**
3. Nome: `Horizon AI Server`
4. Expiration: Nunca (ou configure como preferir)
5. Scopes: Selecione **ALL** (para desenvolvimento)
6. Copie a **API Key** gerada

### 2.3. Configurar .env

Adicione ao arquivo `.env` ou `.env.local` na raiz do projeto:

```env
# Appwrite Configuration
APPWRITE_ENDPOINT=https://cloud.appwrite.io/v1
APPWRITE_PROJECT_ID=your-project-id-here
APPWRITE_API_KEY=your-api-key-here
APPWRITE_DATABASE_ID=horizon_ai_db
```

**‚ö†Ô∏è IMPORTANTE**: Nunca commite o arquivo `.env` com suas credenciais reais!

## üì¶ Passo 3: Criar Database

No Appwrite Console:

1. V√° para **Databases**
2. Clique em **Add Database**
3. Database ID: `horizon_ai_db`
4. Name: `Horizon AI Database`
5. Clique em **Create**

## üóÑÔ∏è Passo 4: Criar Collections

Voc√™ precisa criar 4 collections. Para cada uma:

### 4.1. Collection: Users

**Configura√ß√£o B√°sica:**

- Collection ID: `users`
- Name: `Users`

**Atributos:**

| Key               | Type     | Size | Required | Default | Array |
| ----------------- | -------- | ---- | -------- | ------- | ----- |
| email             | String   | 255  | ‚úÖ       | -       | ‚ùå    |
| password_hash     | String   | 1000 | ‚úÖ       | -       | ‚ùå    |
| is_email_verified | Boolean  | -    | ‚úÖ       | false   | ‚ùå    |
| is_active         | Boolean  | -    | ‚úÖ       | true    | ‚ùå    |
| last_login_at     | DateTime | -    | ‚ùå       | -       | ‚ùå    |

**√çndices:**

- email_idx: UNIQUE on `email`
- is_active_idx: KEY on `is_active`

**Permissions:**

```
Read: users
Write: users
Create: users
Update: users
Delete: users
```

---

### 4.2. Collection: User Profiles

**Configura√ß√£o B√°sica:**

- Collection ID: `user_profiles`
- Name: `User Profiles`

**Atributos:**

| Key           | Type     | Size  | Required | Default | Array |
| ------------- | -------- | ----- | -------- | ------- | ----- |
| user_id       | String   | 255   | ‚úÖ       | -       | ‚ùå    |
| first_name    | String   | 100   | ‚ùå       | -       | ‚ùå    |
| last_name     | String   | 100   | ‚ùå       | -       | ‚ùå    |
| display_name  | String   | 200   | ‚ùå       | -       | ‚ùå    |
| avatar_url    | String   | 1000  | ‚ùå       | -       | ‚ùå    |
| phone_number  | String   | 20    | ‚ùå       | -       | ‚ùå    |
| date_of_birth | DateTime | -     | ‚ùå       | -       | ‚ùå    |
| address       | String   | 10000 | ‚ùå       | -       | ‚ùå    |
| bio           | String   | 2000  | ‚ùå       | -       | ‚ùå    |
| occupation    | String   | 100   | ‚ùå       | -       | ‚ùå    |
| company       | String   | 100   | ‚ùå       | -       | ‚ùå    |
| website       | String   | 255   | ‚ùå       | -       | ‚ùå    |
| social_links  | String   | 2000  | ‚ùå       | -       | ‚ùå    |

**√çndices:**

- user_id_idx: UNIQUE on `user_id`

**Permissions:** Same as Users

---

### 4.3. Collection: User Preferences

**Configura√ß√£o B√°sica:**

- Collection ID: `user_preferences`
- Name: `User Preferences`

**Atributos:**

| Key                         | Type    | Size  | Required | Default  | Array |
| --------------------------- | ------- | ----- | -------- | -------- | ----- |
| user_id                     | String  | 255   | ‚úÖ       | -        | ‚ùå    |
| theme                       | String  | 20    | ‚úÖ       | system   | ‚ùå    |
| language                    | String  | 10    | ‚úÖ       | pt-BR    | ‚ùå    |
| currency                    | String  | 10    | ‚úÖ       | BRL      | ‚ùå    |
| default_dashboard_view      | String  | 50    | ‚ùå       | overview | ‚ùå    |
| dashboard_widgets           | String  | 10000 | ‚ùå       | -        | ‚ùå    |
| email_notifications         | Boolean | -     | ‚úÖ       | true     | ‚ùå    |
| push_notifications          | Boolean | -     | ‚úÖ       | true     | ‚ùå    |
| sms_notifications           | Boolean | -     | ‚úÖ       | false    | ‚ùå    |
| notification_frequency      | String  | 20    | ‚úÖ       | realtime | ‚ùå    |
| show_balances               | Boolean | -     | ‚úÖ       | true     | ‚ùå    |
| auto_categorization_enabled | Boolean | -     | ‚úÖ       | true     | ‚ùå    |
| budget_alerts               | Boolean | -     | ‚úÖ       | true     | ‚ùå    |
| profile_visibility          | String  | 20    | ‚úÖ       | private  | ‚ùå    |
| share_data_for_insights     | Boolean | -     | ‚úÖ       | false    | ‚ùå    |

**√çndices:**

- user_id_idx: UNIQUE on `user_id`

**Permissions:** Same as Users

---

### 4.4. Collection: User Settings

**Configura√ß√£o B√°sica:**

- Collection ID: `user_settings`
- Name: `User Settings`

**Atributos:**

| Key                      | Type     | Size  | Required | Default | Min | Max  | Array |
| ------------------------ | -------- | ----- | -------- | ------- | --- | ---- | ----- |
| user_id                  | String   | 255   | ‚úÖ       | -       | -   | -    | ‚ùå    |
| two_factor_enabled       | Boolean  | -     | ‚úÖ       | false   | -   | -    | ‚ùå    |
| two_factor_method        | String   | 20    | ‚ùå       | -       | -   | -    | ‚ùå    |
| session_timeout          | Integer  | -     | ‚úÖ       | 30      | 5   | 1440 | ‚ùå    |
| password_last_changed_at | DateTime | -     | ‚ùå       | -       | -   | -    | ‚ùå    |
| auto_sync_enabled        | Boolean  | -     | ‚úÖ       | true    | -   | -    | ‚ùå    |
| sync_frequency           | Integer  | -     | ‚úÖ       | 60      | 1   | 1440 | ‚ùå    |
| cloud_backup_enabled     | Boolean  | -     | ‚úÖ       | true    | -   | -    | ‚ùå    |
| connected_banks          | String   | 50000 | ‚ùå       | -       | -   | -    | ‚ùå    |
| connected_apps           | String   | 50000 | ‚ùå       | -       | -   | -    | ‚ùå    |
| beta_features            | Boolean  | -     | ‚úÖ       | false   | -   | -    | ‚ùå    |
| analytics_opt_in         | Boolean  | -     | ‚úÖ       | true    | -   | -    | ‚ùå    |
| custom_settings          | String   | 50000 | ‚ùå       | -       | -   | -    | ‚ùå    |

**√çndices:**

- user_id_idx: UNIQUE on `user_id`
- two_factor_enabled_idx: KEY on `two_factor_enabled`

**Permissions:** Same as Users

## ‚úÖ Passo 5: Verificar Configura√ß√£o

Execute o script de verifica√ß√£o:

```bash
cd apps/api
./scripts/setup-appwrite-db.sh
```

Ou teste diretamente na API:

```bash
pnpm dev
```

E fa√ßa uma requisi√ß√£o:

```bash
curl http://localhost:3000/health
```

## üß™ Passo 6: Testar as Collections

### Criar Usu√°rio Completo

```bash
curl -X POST http://localhost:3000/auth/register \
  -H "Content-Type: application/json" \
  -d '{
    "email": "teste@example.com",
    "password": "senha123"
  }'
```

### Buscar Dados do Usu√°rio

```bash
curl http://localhost:3000/users/:userId
```

### Atualizar Tema

```bash
curl -X PATCH http://localhost:3000/users/:userId/theme \
  -H "Content-Type: application/json" \
  -d '{"theme":"dark"}'
```

## üìä Visualizar Dados no Appwrite Console

1. Acesse o Appwrite Console
2. V√° para **Databases** > **horizon_ai_db**
3. Selecione uma collection
4. Visualize, edite ou delete documentos diretamente

## üîí Seguran√ßa e Permiss√µes

### Permiss√µes Recomendadas para Produ√ß√£o

Para cada collection, configure:

**Read/Write:**

```
Role: Any
Permission: Read
```

```
Role: Users
Permission: Write (own documents only)
```

**No Appwrite Console:**

1. V√° para a collection
2. Clique em **Settings** > **Permissions**
3. Configure:
   - `read("any")` - Qualquer um pode ler
   - `write("user:[USER_ID]")` - Apenas o pr√≥prio usu√°rio pode escrever

## üöÄ Recursos Avan√ßados do Appwrite

### Real-time Subscriptions

```typescript
import { client } from './appwrite.client';

client.subscribe('databases.horizon_ai_db.collections.users.documents', (response) => {
  console.log('Document updated:', response);
});
```

### Storage (Upload de Avatar)

```typescript
import { Storage } from 'node-appwrite';

const storage = new Storage(client);

const file = await storage.createFile('avatars', ID.unique(), avatarFile);
```

### Cloud Functions

Crie functions customizadas no Appwrite para l√≥gica serverless.

## üêõ Troubleshooting

### Erro: "Project not found"

‚úÖ Verifique se o `APPWRITE_PROJECT_ID` est√° correto no `.env`

### Erro: "Invalid API key"

‚úÖ Regenere a API key no Appwrite Console e atualize o `.env`

### Erro: "Database not found"

‚úÖ Certifique-se de criar o database com ID `horizon_ai_db`

### Erro: "Collection not found"

‚úÖ Verifique se todas as 4 collections foram criadas corretamente

## üìö Documenta√ß√£o Adicional

- [Appwrite Docs](https://appwrite.io/docs)
- [Appwrite Database](https://appwrite.io/docs/products/databases)
- [Appwrite Node SDK](https://appwrite.io/docs/sdks#server)

## üéØ Checklist de Configura√ß√£o

- [ ] Conta criada no Appwrite Cloud
- [ ] Projeto criado com nome "Horizon AI"
- [ ] API Key gerada e copiada
- [ ] Arquivo `.env` configurado
- [ ] Database `horizon_ai_db` criado
- [ ] Collection `users` criada com todos os atributos
- [ ] Collection `user_profiles` criada
- [ ] Collection `user_preferences` criada
- [ ] Collection `user_settings` criada
- [ ] √çndices criados em cada collection
- [ ] Permiss√µes configuradas
- [ ] API testada com sucesso

---

**‚úÖ Configura√ß√£o completa! Seu backend Appwrite est√° pronto para uso!** üéâ
